{{ define "main" }}
<div class="container mx-auto px-8 py-8">
    <div class="flex gap-8">
        <!-- 文章内容 -->
        <article class="flex-1 max-w-4xl">
            <!-- 文章头部 -->
            <header class="mb-8">
                <h1 class="text-4xl font-bold mb-4 text-gray-800">{{ .Title }}</h1>
                
                <div class="flex items-center gap-6 text-gray-600 mb-6">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <time>{{ .Date.Format "2006年1月2日" }}</time>
                    </div>
                    {{ if .ReadingTime }}
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>{{ .ReadingTime }} 分钟阅读</span>
                    </div>
                    {{ end }}
                    {{ if .Params.author }}
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span>{{ .Params.author }}</span>
                    </div>
                    {{ end }}
                </div>

                <!-- 标签 -->
                {{ with .Params.tags }}
                <div class="flex flex-wrap gap-2 mb-6">
                    {{ range . }}
                    <span class="btn-glass tooltip-glass" title="点击查看相关文章">
                        #{{ . }}
                        <span class="tooltip-text">点击查看相关文章</span>
                    </span>
                    {{ end }}
                </div>
                {{ end }}

                <!-- 文章描述 -->
                {{ with .Description }}
                <div class="card-glass mb-8">
                    <p class="text-gray-700 dark:text-gray-300 italic m-0">{{ . }}</p>
                </div>
                {{ end }}
            </header>

            <!-- 文章内容 -->
            <div class="prose prose-lg max-w-none mb-8">
                {{ .Content }}
            </div>

            <!-- 文章底部 -->
            <footer class="border-t pt-8 mt-12">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-800">分享这篇文章</h3>
                    <div class="flex gap-3">
                        <button class="p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" onclick="shareToWeibo()">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9.586 8.586L12 11l2.414-2.414L16 9l-4 4-4-4 1.586-1.414z"/>
                            </svg>
                        </button>
                        <button class="p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors" onclick="shareToWeChat()">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.598-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18 0 .659-.52 1.188-1.162 1.188-.642 0-1.162-.529-1.162-1.188 0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18 0 .659-.52 1.188-1.162 1.188-.642 0-1.162-.529-1.162-1.188 0-.651.52-1.18 1.162-1.18z"/>
                            </svg>
                        </button>
                        <button class="p-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors" onclick="copyLink()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- 相关文章推荐 -->
                {{ $related := .Site.RegularPages.Related . | first 3 }}
                {{ with $related }}
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">相关文章推荐</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {{ range . }}
                        <a href="{{ .RelPermalink }}" class="block p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <h4 class="font-medium text-gray-800 mb-2 line-clamp-2">{{ .Title }}</h4>
                            <p class="text-sm text-gray-600 line-clamp-2">{{ .Description | default .Summary }}</p>
                        </a>
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            </footer>
        </article>

        <!-- 右侧目录 -->
        <aside class="w-80 flex-shrink-0">
            <div class="sticky top-8">
                <!-- 目录 -->
                {{ if .TableOfContents }}
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">目录</h3>
                    <nav class="toc">
                        {{ .TableOfContents }}
                    </nav>
                </div>
                {{ end }}

                <!-- 文章信息 -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">文章信息</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">字数</span>
                            <span class="text-gray-800">{{ .WordCount }} 字</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">阅读时间</span>
                            <span class="text-gray-800">{{ .ReadingTime }} 分钟</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">发布时间</span>
                            <span class="text-gray-800">{{ .Date.Format "2006-01-02" }}</span>
                        </div>
                        {{ if .Lastmod }}
                        <div class="flex justify-between">
                            <span class="text-gray-600">更新时间</span>
                            <span class="text-gray-800">{{ .Lastmod.Format "2006-01-02" }}</span>
                        </div>
                        {{ end }}
                    </div>
                </div>

                <!-- 标签云 -->
                {{ with .Params.tags }}
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">标签</h3>
                    <div class="flex flex-wrap gap-2">
                        {{ range . }}
                        <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded hover:bg-gray-200 transition-colors cursor-pointer">
                            #{{ . }}
                        </span>
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            </div>
        </aside>
    </div>
</div>

<script>
// 分享功能
function shareToWeibo() {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);
    window.open(`https://service.weibo.com/share/share.php?url=${url}&title=${title}`, '_blank');
}

function shareToWeChat() {
    // 微信分享需要特殊处理，这里显示提示
    alert('请复制链接分享到微信');
    copyLink();
}

function copyLink() {
    navigator.clipboard.writeText(window.location.href).then(() => {
        // 显示复制成功提示
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
        button.classList.add('bg-green-600');
        button.classList.remove('bg-gray-600');
        
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.classList.remove('bg-green-600');
            button.classList.add('bg-gray-600');
        }, 2000);
    });
}

// 目录高亮
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc a');
    const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
    
    function updateTocHighlight() {
        let current = '';
        headings.forEach(heading => {
            const rect = heading.getBoundingClientRect();
            if (rect.top <= 100) {
                current = heading.id;
            }
        });
        
        tocLinks.forEach(link => {
            link.classList.remove('text-blue-600', 'font-medium');
            if (link.getAttribute('href') === '#' + current) {
                link.classList.add('text-blue-600', 'font-medium');
            }
        });
    }
    
    window.addEventListener('scroll', updateTocHighlight);
    updateTocHighlight();
});
</script>

<style>
.toc ul {
    list-style: none;
    padding-left: 0;
}

.toc li {
    margin: 0.5rem 0;
}

.toc a {
    display: block;
    padding: 0.25rem 0.5rem;
    color: #6b7280;
    text-decoration: none;
    border-radius: 0.25rem;
    transition: all 0.2s;
}

.toc a:hover {
    background-color: #f3f4f6;
    color: #374151;
}

.toc ul ul {
    padding-left: 1rem;
    margin-top: 0.25rem;
}

.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{{ end }}
