{{- if (or (eq .Kind "page") (eq .Kind "section")) }}
{{- if not .Params.cover }}
{{- if (or .Params.headers.image .Params.cover.image) }}
{{- $image := .Params.headers.image | default .Params.cover.image }}
{{- $alt := .Params.headers.caption | default .Params.cover.caption | default "" }}
<style>
    .post-header-cover {
        /* background-image is set inline to avoid linter errors with Hugo template syntax */
        background-position: center;
        background-size: cover;
        background-repeat: no-repeat;
        height: 30vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .post-header-cover-text {
        color: #fff;
        text-align: center;
        font-size: 2rem;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
</style>
<div class="post-header-cover" style="background-image: url('{{ $image }}');">
    <div class="post-header-cover-text">{{- $alt | default .Title -}}</div>
</div>
{{- end }}
{{- end }}
{{- end }}

<header class="header">
    <nav class="nav">
        <div class="logo">
            {{- $label_text := (site.Params.label.text | default site.Title) }}
            {{- if site.Title }}
            <a href="{{ "" | absLangURL }}" accesskey="h" title="{{ $label_text }} (Alt + H)">
                {{- if site.Params.label.icon }}
                {{- $img := resources.Get site.Params.label.icon }}
                {{- if $img }}
                    {{- $processableFormats := (slice "jpg" "jpeg" "png" "tif" "bmp" "gif") -}}
                    {{- if hugo.IsExtended -}}
                        {{- $processableFormats = $processableFormats | append "webp" -}}
                    {{- end -}}
                    {{- $prod := (hugo.IsProduction | or (eq site.Params.env "production")) }}
                    {{- if and (in $processableFormats $img.MediaType.SubType) (eq $prod true)}}
                        {{- if site.Params.label.iconHeight }}
                            {{- $img = $img.Resize (printf "x%d" site.Params.label.iconHeight) }}
                        {{- else }}
                            {{- $img = $img.Resize "x30" }}
                        {{- end }}
                    {{- end }}
                    <img src="{{ $img.Permalink }}" alt="" aria-label="logo"
                        height="{{- site.Params.label.iconHeight | default "30" -}}">
                {{- else }}
                <img src="{{- site.Params.label.icon | absURL -}}" alt="" aria-label="logo"
                    height="{{- site.Params.label.iconHeight | default "30" -}}">
                {{- end -}}
                {{- else if hasPrefix site.Params.label.iconSVG "<svg" }}
                    {{ site.Params.label.iconSVG | safeHTML }}
                {{- end -}}
                {{- $label_text -}}
            </a>
            {{- end }}
        </div>

        <ul id="menu">
            {{- $url := .RelPermalink -}}
            {{- range site.Menus.main }}
            {{- $menuURL := .URL | relLangURL -}}
            <li>
                <a href="{{ $menuURL }}" title="{{ .Name }}">
                    {{- if eq $url $menuURL }}
                    <span class="active">{{ .Name }}</span>
                    {{- else }}
                    {{ .Name }}
                    {{- end }}
                </a>
            </li>
            {{- end }}
            {{- if (and site.Params.search.enable (ne .Kind "section")) }}
            <li>
                <a href="/search/" title="{{ T "search" | default "搜索" }}">
                    {{- T "search" | default "搜索" }}
                </a>
            </li>
            {{- end }}
        </ul>

        {{- if (not site.Params.disableThemeToggle) }}
        <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
            <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </button>
        {{- end }}

        {{- if (not site.Params.disableLangToggle) }}
        <ul class="lang-switch">
            {{- range .Translations }}
            <li>
                <a href="{{ .Permalink }}" title="{{ .Language.LanguageName }}" aria-label="{{ .Language.LanguageName }}">
                    {{ .Language.LanguageName }}
                </a>
            </li>
            {{- end }}
        </ul>
        {{- end }}

        {{- if site.Params.ShowCodeCopyButtons }}
        <button id="share-toggle" accesskey="s" title="(Alt + S)" aria-label="Share">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
        </button>
        {{- end }}
    </nav>
</header>

{{- if site.Params.search.enable }}
<script>
    // 简化的搜索功能
    document.addEventListener('DOMContentLoaded', function() {
        const searchForm = document.createElement('form');
        searchForm.action = '/search/';
        searchForm.method = 'GET';
        searchForm.className = 'search-form';

        const searchInput = document.createElement('input');
        searchInput.type = 'search';
        searchInput.name = 'q';
        searchInput.placeholder = '搜索...';
        searchInput.className = 'search-input';

        searchForm.appendChild(searchInput);

        const menu = document.getElementById('menu');
        if (menu) {
            const searchLi = document.createElement('li');
            searchLi.appendChild(searchForm);
            menu.appendChild(searchLi);
        }
    });
</script>
{{- end }}