<footer>
    <p>&copy; {{ now.Format "2006" }} {{ .Site.Title }}. All rights reserved.</p>
    <p>
        <a href="https://github.com/hobbytp/hobbytp.github.io" target="_blank">GitHub</a> |
        <a href="https://github.com/hobbytp/hobbytp.github.io/issues" target="_blank">反馈</a>
    </p>
</footer>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 处理Mermaid代码块
        document.querySelectorAll('pre > code.language-mermaid').forEach(function (block) {
            const parent = block.parentElement;
            const mermaidDiv = document.createElement('div');
            mermaidDiv.className = 'mermaid';
            mermaidDiv.textContent = block.textContent;
            parent.parentElement.replaceChild(mermaidDiv, parent);
        });

        // 统一的Mermaid初始化
        if (window.mermaid) {
            mermaid.initialize({
                startOnLoad: false, // 因为我们手动处理
                theme: 'default',
                flowchart: {
                    useMaxWidth: true,
                    htmlLabels: true
                }
            });
            // 手动初始化所有mermaid图表
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        }

        // Sidebar Theme Toggle - Extended functionality
        // This extends PaperMod's theme toggle to support multiple buttons
        function toggleTheme() {
            const html = document.querySelector("html");
            const currentTheme = html.dataset.theme;
            const newTheme = currentTheme === "dark" ? "light" : "dark";
            
            html.dataset.theme = newTheme;
            localStorage.setItem("pref-theme", newTheme);
        }

        // Add event listener to sidebar theme toggle button
        const sidebarThemeToggle = document.getElementById("sidebar-theme-toggle");
        if (sidebarThemeToggle) {
            sidebarThemeToggle.addEventListener("click", toggleTheme);
            sidebarThemeToggle.addEventListener("keydown", function (event) {
                if (event.key === "Enter" || event.key === " ") {
                    event.preventDefault();
                    toggleTheme();
                }
            });
        }

        // Ensure header theme toggle also works (if PaperMod's script hasn't loaded yet)
        const headerThemeToggle = document.getElementById("theme-toggle");
        if (headerThemeToggle && !headerThemeToggle.hasAttribute("data-listener-added")) {
            headerThemeToggle.addEventListener("click", toggleTheme);
            headerThemeToggle.setAttribute("data-listener-added", "true");
        }
    });
</script>