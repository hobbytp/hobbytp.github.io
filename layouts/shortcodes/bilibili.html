{{/*
B站视频Shortcode

使用方法:
{{< bilibili BV1xx411x7x7 >}}
{{< bilibili id="BV1xx411x7x7" >}}
{{< bilibili id="BV1xx411x7x7" title="视频标题" >}}
{{< bilibili id="BV1xx411x7x7" autoplay="true" >}}
*/}}

{{ $id := .Get 0 }}
{{ if .Get "id" }}
  {{ $id = .Get "id" }}
{{ end }}

{{ if $id }}
  {{/* 提取B站视频ID，支持BV和AV号 */}}
  {{ $videoId := $id }}

  {{/* B站iframe嵌入代码 */}}
  <div class="bilibili-video-wrapper" style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <iframe
      src="https://player.bilibili.com/player.html?bvid={{ $videoId }}&autoplay=0&danmaku=0&high_quality=1"
      style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 8px;"
      allowfullscreen="true"
      sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups">
    </iframe>
  </div>

  {{/* 可选的视频信息显示 */}}
  {{ if .Get "title" }}
    <p class="bilibili-video-title" style="margin-top: 0.5rem; font-size: 0.9rem; color: #666; text-align: center;">
      📺 {{ .Get "title" }}
    </p>
  {{ end }}

  {{/* 链接到原始视频 */}}
  <p class="bilibili-video-link" style="margin-top: 0.25rem; font-size: 0.8rem; color: #999; text-align: center;">
    <a href="https://www.bilibili.com/video/{{ $videoId }}" target="_blank" rel="noopener noreferrer" style="color: #00a1d6; text-decoration: none;">
      🔗 在B站观看完整视频
    </a>
  </p>

{{ else }}
  {{ errorf "bilibili shortcode: 缺少视频ID参数" }}
{{ end }}

<style>
/* 响应式视频容器 */
@media (max-width: 768px) {
  .bilibili-video-wrapper {
    padding-bottom: 75%; /* 移动端更宽的纵横比 */
  }
}

/* 暗色模式支持 */
@media (prefers-color-scheme: dark) {
  .bilibili-video-title {
    color: #ccc !important;
  }

  .bilibili-video-link {
    color: #aaa !important;
  }

  .bilibili-video-link a {
    color: #4fc3f7 !important;
  }
}

/* 打印样式 */
@media print {
  .bilibili-video-wrapper {
    display: none;
  }

  .bilibili-video-title,
  .bilibili-video-link {
    display: block;
    background: #f0f0f0;
    padding: 1rem;
    border-radius: 4px;
    font-size: 12pt;
  }
}
</style>
