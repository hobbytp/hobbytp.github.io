{{/*
PDF Viewer Shortcode

æ”¯æŒåµŒå…¥å’Œé¢„è§ˆ PDF æ–‡ä»¶ï¼Œå¸¦æœ‰ç¾è§‚çš„ UI è®¾è®¡

ä½¿ç”¨æ–¹æ³•:
1. æœ¬åœ° PDF æ–‡ä»¶:
   {{< pdf src="/pdf/presentation.pdf" >}}

2. å¸¦æ ‡é¢˜:
   {{< pdf src="/pdf/presentation.pdf" title="æˆ‘çš„æ¼”ç¤ºæ–‡ç¨¿" >}}

3. è‡ªå®šä¹‰é«˜åº¦:
   {{< pdf src="/pdf/presentation.pdf" height="800px" >}}

4. å¤–éƒ¨ PDF URL:
   {{< pdf src="https://example.com/document.pdf" >}}

5. Google Docs/Drive é¢„è§ˆ:
   {{< pdf src="https://docs.google.com/..." type="google" >}}

å‚æ•°è¯´æ˜:
- src: PDF æ–‡ä»¶è·¯å¾„æˆ– URLï¼ˆå¿…éœ€ï¼‰
- title: æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰
- height: æŸ¥çœ‹å™¨é«˜åº¦ï¼Œé»˜è®¤ 600pxï¼ˆå¯é€‰ï¼‰
- type: ç±»å‹ï¼Œå¯é€‰ "default" æˆ– "google"ï¼ˆå¯é€‰ï¼‰
- download: æ˜¯å¦æ˜¾ç¤ºä¸‹è½½æŒ‰é’®ï¼Œé»˜è®¤ trueï¼ˆå¯é€‰ï¼‰
*/}}

{{ $src := .Get "src" }}
{{ $title := .Get "title" | default "" }}
{{ $height := .Get "height" | default "600px" }}
{{ $type := .Get "type" | default "default" }}
{{ $download := .Get "download" | default "true" }}
{{ $id := printf "pdf-%d" .Ordinal }}

{{ if $src }}

<div class="pdf-viewer-container" id="{{ $id }}" style="margin: 2rem 0; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.12); background: #f8f9fa;">
  
  {{/* å¤´éƒ¨å·¥å…·æ  */}}
  <div class="pdf-header" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
    <div class="pdf-title-section" style="display: flex; align-items: center; gap: 0.75rem;">
      <span style="font-size: 1.5rem;">ğŸ“„</span>
      <div>
        <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600;">
          {{ if $title }}{{ $title }}{{ else }}PDF æ–‡æ¡£æŸ¥çœ‹å™¨{{ end }}
        </h3>
        <span style="font-size: 0.8rem; opacity: 0.85;">ç‚¹å‡»ä¸‹æ–¹æŸ¥çœ‹å®Œæ•´æ–‡æ¡£</span>
      </div>
    </div>
    
    <div class="pdf-controls" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
      {{/* å…¨å±æŒ‰é’® */}}
      <button onclick="togglePdfFullscreen('{{ $id }}')" 
              style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 0.35rem; transition: background 0.2s;"
              onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
              onmouseout="this.style.background='rgba(255,255,255,0.2)'">
        <span>â›¶</span> å…¨å±
      </button>
      
      {{/* æ–°çª—å£æ‰“å¼€ */}}
      <a href="{{ $src }}" target="_blank" rel="noopener noreferrer"
         style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 0.35rem; text-decoration: none; transition: background 0.2s;"
         onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
         onmouseout="this.style.background='rgba(255,255,255,0.2)'">
        <span>ğŸ”—</span> æ–°çª—å£
      </a>
      
      {{/* ä¸‹è½½æŒ‰é’® */}}
      {{ if eq $download "true" }}
      <a href="{{ $src }}" download 
         style="background: rgba(255,255,255,0.9); border: none; color: #c0392b; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 0.35rem; text-decoration: none; font-weight: 500; transition: background 0.2s;"
         onmouseover="this.style.background='rgba(255,255,255,1)'" 
         onmouseout="this.style.background='rgba(255,255,255,0.9)'">
        <span>â¬‡ï¸</span> ä¸‹è½½
      </a>
      {{ end }}
    </div>
  </div>

  {{/* PDF å†…å®¹åŒºåŸŸ */}}
  <div class="pdf-content" style="position: relative; background: #525659;">
    {{ if eq $type "google" }}
      {{/* Google Docs/Drive åµŒå…¥ */}}
      <iframe 
        src="{{ $src }}"
        style="width: 100%; height: {{ $height }}; border: none;"
        allowfullscreen="true"
        loading="lazy">
      </iframe>
    {{ else }}
      {{/* æ ‡å‡† PDF åµŒå…¥ - ä½¿ç”¨ object æ ‡ç­¾ä½œä¸ºä¸»è¦æ–¹å¼ï¼Œiframe ä½œä¸ºå¤‡é€‰ */}}
      <object 
        data="{{ $src }}" 
        type="application/pdf" 
        style="width: 100%; height: {{ $height }}; border: none;">
        {{/* å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ objectï¼Œæ˜¾ç¤º iframe */}}
        <iframe 
          src="{{ $src }}"
          style="width: 100%; height: {{ $height }}; border: none;"
          loading="lazy">
        </iframe>
        {{/* å¦‚æœ iframe ä¹Ÿä¸æ”¯æŒï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯ */}}
        <div style="padding: 3rem; text-align: center; background: #f8f9fa;">
          <p style="font-size: 1.1rem; color: #666; margin-bottom: 1rem;">
            ğŸ˜… æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå†…åµŒ PDF é¢„è§ˆ
          </p>
          <a href="{{ $src }}" target="_blank" rel="noopener noreferrer"
             style="display: inline-block; background: #e74c3c; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 500;">
            ğŸ“„ ç‚¹å‡»æŸ¥çœ‹/ä¸‹è½½ PDF
          </a>
        </div>
      </object>
    {{ end }}
    
    {{/* åŠ è½½æç¤º */}}
    <div class="pdf-loading" id="{{ $id }}-loading" 
         style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.95); padding: 1.5rem 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); text-align: center; z-index: 10; pointer-events: none; opacity: 0; transition: opacity 0.3s;">
      <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“„</div>
      <div style="color: #666;">æ­£åœ¨åŠ è½½ PDF...</div>
    </div>
  </div>

  {{/* åº•éƒ¨ä¿¡æ¯æ  */}}
  <div class="pdf-footer" style="background: #f1f3f4; padding: 0.75rem 1.5rem; font-size: 0.85rem; color: #666; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
    <span style="display: flex; align-items: center; gap: 0.5rem;">
      <span>ğŸ’¡</span>
      <span>æç¤ºï¼šå¯ä½¿ç”¨é¼ æ ‡æ»šè½®ç¼©æ”¾ï¼Œæˆ–ç‚¹å‡»å…¨å±æŸ¥çœ‹</span>
    </span>
    <span style="opacity: 0.7;">
      {{ if $title }}{{ $title }}{{ else }}PDF Document{{ end }}
    </span>
  </div>
</div>

{{ else }}
  <div style="padding: 2rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; color: #856404; text-align: center;">
    âš ï¸ PDF shortcode é”™è¯¯ï¼šç¼ºå°‘ src å‚æ•°
    <br>
    <code style="font-size: 0.85rem; background: rgba(0,0,0,0.1); padding: 0.25rem 0.5rem; border-radius: 4px;">
      {{&lt; pdf src="/path/to/file.pdf" &gt;}}
    </code>
  </div>
{{ end }}

<style>
/* PDF Viewer å“åº”å¼æ ·å¼ */
@media (max-width: 768px) {
  .pdf-viewer-container .pdf-header {
    padding: 0.75rem 1rem !important;
  }
  
  .pdf-viewer-container .pdf-title-section h3 {
    font-size: 1rem !important;
  }
  
  .pdf-viewer-container .pdf-controls button,
  .pdf-viewer-container .pdf-controls a {
    padding: 0.4rem 0.75rem !important;
    font-size: 0.8rem !important;
  }
  
  .pdf-viewer-container .pdf-footer {
    flex-direction: column;
    text-align: center;
  }
}

/* å…¨å±æ¨¡å¼æ ·å¼ */
.pdf-viewer-container.pdf-fullscreen {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  margin: 0 !important;
  border-radius: 0 !important;
  z-index: 9999 !important;
}

.pdf-viewer-container.pdf-fullscreen .pdf-content object,
.pdf-viewer-container.pdf-fullscreen .pdf-content iframe {
  height: calc(100vh - 120px) !important;
}

/* æš—è‰²æ¨¡å¼æ”¯æŒ */
@media (prefers-color-scheme: dark) {
  .pdf-viewer-container {
    background: #2d2d2d !important;
  }
  
  .pdf-viewer-container .pdf-footer {
    background: #3d3d3d !important;
    color: #ccc !important;
  }
}

/* æ‰“å°æ—¶éšè— */
@media print {
  .pdf-viewer-container {
    display: none !important;
  }
}
</style>

<script>
// PDF å…¨å±åˆ‡æ¢
function togglePdfFullscreen(id) {
  const container = document.getElementById(id);
  if (!container) return;
  
  if (container.classList.contains('pdf-fullscreen')) {
    container.classList.remove('pdf-fullscreen');
    document.body.style.overflow = '';
  } else {
    container.classList.add('pdf-fullscreen');
    document.body.style.overflow = 'hidden';
  }
}

// ESC é”®é€€å‡ºå…¨å±
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const fullscreenPdf = document.querySelector('.pdf-viewer-container.pdf-fullscreen');
    if (fullscreenPdf) {
      fullscreenPdf.classList.remove('pdf-fullscreen');
      document.body.style.overflow = '';
    }
  }
});
</script>
