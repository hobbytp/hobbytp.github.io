---
title: Agentic设计模式：Planning
date: "2025-11-04T18:10:00+08:00"
draft: false
tags: ["AI", "Planning", "设计模式", "design pattern", "agentic"]
categories: ["mas"]
description: "Planning模式要求智能体在执行开始之前，先将一个复杂的目标分解为结构化的路线图或有序的步骤序列。它将智能体从简单的反应者升级为主动的战略执行者。"
---

## Planning设计模式

**Planning**（规划）模式是一种**核心智能体逻辑模式**，要求智能体在开始执行之前，先将一个复杂的高层任务分解成一个**结构化的、有序的步骤序列**（路线图）。规划机制利用大语言模型的推理能力，根据任务理解和约束条件生成合理有效的计划。规划模式解决了缺乏前瞻性思维的智能体无法应对多步骤、依赖关系复杂的请求的问题。

### Pattern Card

```yaml
Name: Planning (规划)
One-liner: 智能体在执行前分析任务、识别依赖，生成结构化的分步路线图以指导后续行动。
Problem-Solution Fit: 解决复杂任务中隐藏的依赖性和排序问题，避免因中途发现错误而导致的昂贵返工和资源浪费。
Key Value: 明确任务的复杂性，防止昂贵的错误启动。使智能体从被动反应者转变为主动的**战略执行者**。
Complexity: ⭐⭐⭐☆☆
When to Use: 
  - 任务具有隐藏复杂性，或特发性（Ad-hoc）方法经常失败。
  - 任务需要协调多个系统或合成来自不同来源的信息。
  - 自动化多步骤流程，如生成研究报告或执行复杂项目管理。
When NOT to Use: 
  - 简单的单步任务（规划会带来纯粹的开销和延迟）。
  - 流程已预定义且固定（顺序模式更高效）。
  - 对实时性要求极高的场景。
```

**比喻：Planning 模式**

如果将一个智能体比作一个**建筑队**，那么**规划模式**就是**蓝图工程师**。建筑队（执行者）不会直接开始砌砖（行动），而是：

1. **（分析）** 蓝图工程师分析客户需求（目标）。
2. **（规划）** 生成详细的施工图纸（结构化计划），确定地基、框架、内饰的顺序和依赖关系。
3. **（执行）** 只有在图纸完成后，执行者才开始严格按照路线图施工，从而避免在盖到一半时才发现地基打错或材料不足。

### I. 概述、背景与核心问题（Context & Problem）

1. **核心概念与定义**
    规划模式要求智能体在执行开始之前，**先将一个复杂的目标分解为结构化的路线图或有序的步骤序列**。该过程包括分析要求、识别子任务之间的依赖关系，并按逻辑顺序排列操作。

2. **解决的问题**
    该模式解决了复杂问题**无法通过单一行动解决**的挑战，以及智能体在执行中途发现采取了错误方法或遗漏了依赖关系，导致的昂贵的**错误启动和返工**问题。规划机制使智能体能够应对非简单、非单步的问题，并编排复杂工作流。

### II. 核心思想、角色与机制（Core Concept & Workflow）

规划模式的核心是**先规划，后执行**的方法，它将智能体从简单的反应者升级为主动的战略执行者。

1. **分析要求：** 智能体首先分析高层目标，理解其复杂性和约束条件。
2. **分解任务（Task Decomposition）：** 将高层目标拆解为一系列可管理的子任务或具体步骤。
3. **排序与依赖识别：** 识别子任务之间的依赖关系，并按逻辑顺序排列操作。
4. **执行计划：** 只有在详细计划制定完成后，智能体才开始按照该路线图**逐一执行**。
5. **动态适应（可选）：** 计划的步骤或检查点可以根据执行过程中获得的新信息动态修订或重新规划。

### III. 架构蓝图与可视化（Architecture & Visualization）

规划模式通常涉及**角色分离**，即一个智能体负责规划，其他智能体负责执行。

* **规划者（Planner/Manager Agent）：** 负责接收用户目标，并分解为结构化计划。
* **执行者（Worker/Executor Agents）：** 负责按照计划中的步骤，使用工具或知识完成子任务。
* **结构元素：** 规划智能体、结构化计划（路线图）、执行智能体。
* **核心关联：** 规划模式是**层级分解**（Hierarchical Decomposition）的基础。它与**工具使用**模式紧密结合，因为计划的许多步骤都需要调用外部工具来完成。

```mermaid
graph TB
subgraph "Planning Pattern"
Start([用户高层目标]) --> Analyze[分析要求]
Analyze --> Plan{规划器 Agent:
任务分解 & 排序}
Plan --> Roadmap[结构化计划:
Step 1 -> Step 2 -> Step N]
Roadmap --> Execute1[执行 Step 1]
Execute1 --> Execute2[执行 Step 2]
Execute2 --> Check{检查进度/新信息}
Check -- 需要调整 --> Replan[重新规划 (动态调整)]
Replan --> Roadmap
Check -- 完成所有步骤 --> End([最终结果])
ExecuteN[执行 Step N]
Execute2 --> ExecuteN
ExecuteN --> Check
end
style Start fill:#e8f5e9
style End fill:#e8f5e9
style Plan fill:#fff3e0
style Execute1 fill:#ffebee
style Execute2 fill:#ffebee
style ExecuteN fill:#ffebee
style Roadmap fill:#f3e5f5
style Check fill:#fce4ec
```

### IV. 优势、价值与设计权衡（Value & Trade-offs）

1. **价值与优势**
    * **效率提升：** 通过预先识别依赖关系和避免执行中途的错误，防止昂贵的**假启动和返工**。
    * **透明度：** 计划步骤外化，使整个工作流更具**可监控性**，便于早期发现瓶颈或失败。
    * **模块化与协作：** 清晰的计划便于将任务委派给不同的专业智能体（如层级模式）或进行**并行化**处理。

2. **局限性与设计权衡**
    * **开销/延迟：** 对于可以一步完成或流程固定的简单任务，规划步骤是纯粹的**计算开销**，会增加延迟和成本。
    * **计划质量依赖：** 规划的有效性高度依赖于底层大型语言模型**生成合理计划的能力**。
    * **刚性风险：** 如果计划是单路径、线性且固定的，则可能缺乏灵活性，难以适应动态变化。高级Planning模式（如Multi-Path Plan Generator）可以解决此问题，但会增加系统复杂性。

### V. 适用场景与选择标准（Use Cases & Selection Criteria）

规划模式适用于目标不明确、需要协调复杂资源或要求长期自主执行的场景。

* **项目管理：** 将“确保项目里程碑完成”等目标分解为任务，并根据进度进行监控和调整。
* **旅行规划：** 接收“计划巴黎之旅”等目标，分解为多个行程、航班和酒店预订步骤。
* **机器人与导航：** 在复杂环境中（如避障、遵守规则）生成从初始状态到目标状态的路径。
* **复杂研究与报告：** 制定分阶段的信息收集、数据摘要和内容结构化流程。

**选择决策树**
当你需要评估任务复杂度时，规划模式是重要的考虑因素：

| 维度 | 决策点 | 推荐模式 |
| :--- | :--- | :--- |
| **可预测性** | **任务流程是固定且线性的吗？** | 是 → 顺序执行流程 (Sequential)。否 → 需要动态编排 (如 Planning 或 Routing)。 |
| **任务复杂度** | **任务是真正复杂的，无法单步完成吗？** | 是 → 考虑 **Planning** 或 多智能体协作。否 → 从 ReAct 或 Tool Use 开始。 |
| **自主性** | **系统需要自主构建和优化任务列表以达成目标吗？** | 是 → **Planning** (例如 Magentic Orchestration)。 |

### VI. 实现、框架支持与关联模式（Implementation & Relations）

规划模式是构建自主智能体系统的核心基石。

#### 核心实现

实现 Planning 的核心是利用 LLM 的推理能力，通过提示工程（如 CoT 或结构化输出）要求其在执行前生成一个明确的步骤序列。这个计划通常以结构化格式（如列表或 JSON）输出，随后由执行器严格遵循。

#### 框架支持

* **CrewAI：** CrewAI 的 **Sequential Process**（顺序执行流程）和 **Hierarchical Process**（层级流程）都支持 Planning 的应用，其中管理器代理负责动态任务分配和计划。
* **AutoGen：** AutoGen 实现了 **任务分解与规划模式**（Task Decomposition & Planning Pattern），将规划者的角色与执行者分离。
* **LangGraph：** Planning Agent 是 LangGraph 架构中的一个关键组件，特别是在计划执行式架构中，规划智能体生成子任务序列，专业智能体执行，结果返回规划智能体进行动态调整。
* **Coze：** Coze 平台提供了 **Planning Mode**（规划模式）和 **Orchestrator-Workers Planning Pattern**，强调在执行前生成计划并允许用户审批。
* **AutoGPT：** 其任务分解与优先级排序模式（Task Decomposition & Prioritization Pattern）是 Planning 的典型体现。

#### 关联模式

* **ReAct (Reason and Act)：** ReAct 与 Planning 可结合使用。Planning 模式先生成高层、静态的计划，然后 ReAct 循环用于执行计划中的**每个具体步骤**（思考-行动-观察），实现局部动态适应。
* **任务分解 (Task Decomposition)：** Planning 的核心行为机制。
* **目标设定与监控（Goal Setting and Monitoring）：** 目标为 Planning 提供最终的成功标准，监控机制则跟踪计划的进展，并提供反馈以调整计划。
* **层级分解 (Hierarchical Decomposition)：** 规划模式常用于层级架构中，管理者智能体负责目标分解并将子任务委派给下一层。

---

为了更形象地理解规划模式，可以想象它就像一位**围棋高手**，不会只看眼前的一步（ReAct），而是先在大局上制定战略（Planning），分解为几个子目标（任务分解），然后用精妙的局部战术（ReAct或Tool Use）去逐一实现这些子目标，并根据对手（环境）的反馈动态调整其整体战略。
