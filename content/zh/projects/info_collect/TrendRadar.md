---
title: "TrendRadar - å¤šå¹³å°çƒ­ç‚¹èšåˆå’ŒAIæ™ºèƒ½åˆ†æ"
date: 2025-12-05T00:00:00+08:00
lastmod: 2026-01-01T16:00:00+08:00
draft: false
tags: ["TrendRadar", "çƒ­ç‚¹èšåˆ", "AIæ™ºèƒ½åˆ†æ"]
categories: ["projects"]
description: "TrendRadar æ˜¯ä¸€ä¸ªç”¨äºå¤šå¹³å°çƒ­ç‚¹èšåˆå’ŒAIæ™ºèƒ½åˆ†æçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬çƒ­ç‚¹æ–°é—»ç›‘æ§ã€æ™ºèƒ½ç­›é€‰åŠæ¨é€ï¼ŒåŒæ—¶æ”¯æŒåŸºäºMCPåè®®çš„æ·±åº¦åˆ†æã€‚"
wordCount: 2029
readingTime: 6
---


## TrendRadar

TrendRadar ([github](https://github.com/sansan0/TrendRadar), 38k stars ï¼ˆæˆªæ­¢2025-12ï¼‰) æ˜¯ä¸€ä¸ªç”¨äºå¤šå¹³å°çƒ­ç‚¹èšåˆå’ŒAIæ™ºèƒ½åˆ†æçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬çƒ­ç‚¹æ–°é—»ç›‘æ§ã€æ™ºèƒ½ç­›é€‰åŠæ¨é€ï¼ŒåŒæ—¶æ”¯æŒåŸºäºMCPåè®®çš„æ·±åº¦åˆ†æã€‚æ ¸å¿ƒç‰¹ç‚¹ï¼š

1. **åŠŸèƒ½æ¦‚è¿°**ï¼š
   - èšåˆ35ä¸ªå¹³å°çƒ­ç‚¹ï¼ˆçŸ¥ä¹ã€æŠ–éŸ³ã€Bç«™ã€åå°”è¡—è§é—»ç­‰ï¼‰ã€‚
   - æä¾›å…¨ç½‘çƒ­ç‚¹æ±‡æ€»ï¼ˆæ¯æ—¥ã€å½“å‰æ¦œå•ã€å¢é‡ç›‘æ§ä¸‰ç§æ¨¡å¼ï¼‰ã€‚
   - æ™ºèƒ½æ¨é€ï¼šå¯æŒ‰å…³é”®è¯ç­›é€‰çƒ­ç‚¹ï¼Œå¹¶è®¾å®šæ—¶é—´çª—å£ã€‚
   - çƒ­ç‚¹è¶‹åŠ¿åˆ†æï¼šå®æ—¶è¿½è¸ªæ–°é—»çƒ­åº¦å˜åŒ–ï¼Œæ”¯æŒè·¨å¹³å°å¯¹æ¯”ã€‚

2. **AIå¢å¼º**ï¼š
   - AIå¯¹è¯åˆ†æåŠŸèƒ½ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æé—®ï¼Œè¿›è¡Œçƒ­ç‚¹è¶‹åŠ¿è¿½è¸ªã€æƒ…æ„Ÿåˆ†æã€ç›¸å…³æ£€ç´¢ç­‰ã€‚
   - æä¾›æœ¬åœ°æµ‹è¯•æ•°æ®ï¼Œå¯åˆ©ç”¨Dockeréƒ¨ç½²MCPæœåŠ¡æ”¯æŒAIä½¿ç”¨ã€‚

3. **å¤šæ¸ é“æ¨é€**ï¼š
   - æ”¯æŒé£ä¹¦ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€Telegramã€Slackã€é‚®ä»¶ã€Bark ç­‰æ¨é€æ–¹å¼ã€‚
   - ç®¡ç†å¤šè´¦å·æ¨é€åŠŸèƒ½ï¼Œé€‚ç”¨äºå¤šç§åœºæ™¯ã€‚

4. **ä¾¿æ·éƒ¨ç½²**ï¼š
   - æ¨èä½¿ç”¨Dockeréƒ¨ç½²ï¼Œ30ç§’ç½‘é¡µç”Ÿæˆï¼Œ1åˆ†é’Ÿæ‰‹æœºé€šçŸ¥ï¼Œæ— éœ€ç¼–ç¨‹åŸºç¡€ã€‚
   - é¡¹ç›®éµå¾ªâ€œUse this templateâ€ï¼Œé¿å… Forkã€‚

5. **é€‚ç”¨äººç¾¤**ï¼š
   - ä¼ä¸šç®¡ç†è€…ã€è‡ªåª’ä½“äººã€æŠ•èµ„è€…å’Œæ™®é€šç”¨æˆ·ï¼Œç”¨äºå“ç‰Œèˆ†æƒ…ç›‘æ§ã€è¡Œä¸šåŠ¨æ€è¿½è¸ªåŠæ—¶äº‹çƒ­ç‚¹æŸ¥çœ‹ã€‚

6. **æ›´æ–°ç‰¹è‰²**ï¼š
   - æ–°å¢å¤šè´¦å·æ¨é€æ”¯æŒã€å…¨å±€è¿‡æ»¤å…³é”®è¯ã€å†…å®¹é¡ºåºé…ç½®ç­‰åŠŸèƒ½ã€‚
   - æ–‡æ¡£ä¼˜åŒ–ï¼Œæä¾›è¯¦ç»†é…ç½®æ•™ç¨‹ã€‚

é¡¹ç›®æä¾›ç”¨æˆ·å‹å¥½çš„è®¾ç½®é€‰æ‹©ï¼Œå¯å¿«é€Ÿé«˜æ•ˆåœ°è¿½è¸ªå’Œåˆ†æçƒ­ç‚¹èµ„è®¯ï¼ŒåŒæ—¶åˆ©ç”¨AIå·¥å…·æ·±åº¦æŒ–æ˜æ–°é—»æ•°æ®ã€‚

## TrendRadar æºç åˆ†æ

### **æ¶æ„æ·±åº¦è¯„ä»·**

#### **1. æ¶æ„ä¼˜åŠ¿**

- **æè‡´è½»é‡ä¸çµæ´»éƒ¨ç½²**: åŒæ—¶æ”¯æŒ GitHub Actions (æ— çŠ¶æ€)ã€Docker (å®¹å™¨åŒ–) å’Œæœ¬åœ°è¿è¡Œï¼Œé€šè¿‡ `StorageManager` æ™ºèƒ½åˆ‡æ¢ SQLite/S3 å­˜å‚¨ï¼Œæå¤§é™ä½äº†ä½¿ç”¨é—¨æ§›ã€‚
- **æ¨¡å—åŒ–æ ¸å¿ƒè®¾è®¡**: æ ¸å¿ƒæ¨¡å—èŒè´£è¾¹ç•Œæ¸…æ™° (Crawler, Core, Storage, Notification)ï¼Œæ–°å¢æ¨é€æ¸ é“ç¬¦åˆå¼€é—­åŸåˆ™ã€‚
- **å‰ç»æ€§ AI èåˆ**: åŸç”Ÿæ”¯æŒ MCP åè®®ï¼Œå°†ä¼ ç»Ÿçˆ¬è™«è½¬åŒ–ä¸º AI Agent çš„æ„ŸçŸ¥å·¥å…·ï¼Œæä¾›è‡ªç„¶è¯­è¨€æ—¥æœŸè§£æå’Œè¶‹åŠ¿åˆ†æç­‰é«˜çº§è¯­ä¹‰èƒ½åŠ›ã€‚

#### **2. å¯æ‰©å±•æ€§**
- **æ•°æ®æºæ‰©å±•**: é€šç”¨çš„ `DataFetcher` æ¥å£å’Œ RSS æ¨¡å—è®¾è®¡è¯æ˜äº†å¯¹å¼‚æ„æ•°æ®æºçš„è‰¯å¥½å…¼å®¹æ€§ã€‚
- **AI èƒ½åŠ›æ‰©å±•**: FastMCP 2.0 æ¶æ„ä½¿å¾—æ–°å¢ NLP å·¥å…·ï¼ˆå¦‚æƒ…æ„Ÿåˆ†æã€æ‘˜è¦ç”Ÿæˆï¼‰éå¸¸ä¾¿æ·ã€‚

#### **3. æ”¹è¿›æ–¹å‘**
- **å¹¶å‘æ€§èƒ½**: `DataFetcher` ç›®å‰é‡‡ç”¨ä¸²è¡ŒæŠ“å–ï¼Œé¢å¯¹å¤§é‡æ•°æ®æºæ—¶ IO é˜»å¡å°†æˆä¸ºç“¶é¢ˆï¼Œå»ºè®®å¼•å…¥å¼‚æ­¥å¹¶å‘ã€‚
- **èŒè´£è§£è€¦**: `NewsAnalyzer` ç±»æ‰¿æ‹…äº†è¿‡å¤šç¼–æ’èŒè´£ï¼Œå»ºè®®æœªæ¥æ‹†åˆ†ä¸ºæ›´ç»†ç²’åº¦çš„ Pipeline æ¨¡å¼ã€‚
- **é…ç½®ç®¡ç†**: `config.yaml` æ—¥ç›Šåºå¤§ï¼Œå»ºè®®å¼•å…¥å¼ºç±»å‹é…ç½®éªŒè¯ (å¦‚ Pydantic) ä»¥å‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚

---

æœ¬æ–‡æ¡£ä½¿ç”¨ UML æ ‡å‡†ä»å¤šè§’åº¦æè¿° TrendRadar çš„æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ¦‚è§ˆã€æ ¸å¿ƒç»„ä»¶ã€æ•°æ®æµã€ç±»ç»“æ„ç­‰ã€‚

---

### ç›®å½•

1. [ç³»ç»Ÿæ¦‚è§ˆ](#1-ç³»ç»Ÿæ¦‚è§ˆ)
2. [æ ¸å¿ƒåŠŸèƒ½ä¸åˆ›æ–°ç‚¹](#2-æ ¸å¿ƒåŠŸèƒ½ä¸åˆ›æ–°ç‚¹)
3. [ç³»ç»Ÿæ¶æ„å›¾](#3-ç³»ç»Ÿæ¶æ„å›¾)
4. [ç»„ä»¶æ¶æ„](#4-ç»„ä»¶æ¶æ„)
5. [ç±»å›¾](#5-ç±»å›¾)
6. [æ—¶åºå›¾](#6-æ—¶åºå›¾)
7. [æ•°æ®æµå›¾](#7-æ•°æ®æµå›¾)
8. [éƒ¨ç½²æ¶æ„](#8-éƒ¨ç½²æ¶æ„)
9. [MCP æœåŠ¡æ¶æ„](#9-mcp-æœåŠ¡æ¶æ„)

---

### 1. ç³»ç»Ÿæ¦‚è§ˆ

TrendRadar æ˜¯ä¸€ä¸ª**è½»é‡çº§çƒ­ç‚¹æ–°é—»èšåˆä¸åˆ†æç³»ç»Ÿ**ï¼Œæ”¯æŒï¼š

- ğŸ”¥ **å…¨ç½‘çƒ­ç‚¹èšåˆ**ï¼š11+ ä¸»æµå¹³å°çƒ­æ¦œæ•°æ®æŠ“å–
- ğŸ“° **RSS è®¢é˜…**ï¼šæ”¯æŒ RSS/Atom è®¢é˜…æº
- ğŸ¤– **AI æ™ºèƒ½åˆ†æ**ï¼šåŸºäº MCP åè®®çš„ 17 ç§åˆ†æå·¥å…·
- ğŸ“± **å¤šæ¸ é“æ¨é€**ï¼šé£ä¹¦ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€Telegramã€Slackã€Email ç­‰
- ğŸŒ **å¤šç¯å¢ƒéƒ¨ç½²**ï¼šGitHub Actionsã€Dockerã€æœ¬åœ°è¿è¡Œ

#### 1.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| è¯­è¨€ | Python 3.8+ |
| å­˜å‚¨ | SQLite (æœ¬åœ°) / S3 å…¼å®¹å­˜å‚¨ (è¿œç¨‹) |
| MCP æœåŠ¡ | FastMCP 2.0 |
| éƒ¨ç½² | Docker / GitHub Actions |

---

### 2. æ ¸å¿ƒåŠŸèƒ½ä¸åˆ›æ–°ç‚¹

#### 2.1 æ ¸å¿ƒåŠŸèƒ½

```mermaid
mindmap
  root((TrendRadar))
    æ•°æ®é‡‡é›†
      çƒ­æ¦œçˆ¬è™«
        11+å¹³å°æ”¯æŒ
        è‡ªåŠ¨é‡è¯•æœºåˆ¶
        ä»£ç†æ”¯æŒ
      RSSè®¢é˜…
        Atom/RSSè§£æ
        æŒ‰å…³é”®è¯åˆ†ç»„
    æ™ºèƒ½åˆ†æ
      å…³é”®è¯åŒ¹é…
        å¿…é¡»è¯/è¿‡æ»¤è¯
        è¯ç»„åŒ–ç®¡ç†
      æƒé‡ç®—æ³•
        æ’åæƒé‡
        é¢‘ç‡æƒé‡
        çƒ­åº¦æƒé‡
    æ¨é€é€šçŸ¥
      å¤šæ¸ é“æ”¯æŒ
        é£ä¹¦/é’‰é’‰
        ä¼ä¸šå¾®ä¿¡
        Telegram
        Slack/Email
      æ™ºèƒ½ç­–ç•¥
        å¢é‡æ¨¡å¼
        å½“æ—¥æ±‡æ€»
        æ—¶é—´çª—å£
    AIåˆ†æ
      MCPåè®®
      17ç§å·¥å…·
      è‡ªç„¶è¯­è¨€äº¤äº’
```

#### 2.2 æ ¸å¿ƒåˆ›æ–°ç‚¹

| åˆ›æ–°ç‚¹ | æè¿° |
|--------|------|
| **ç»Ÿä¸€å­˜å‚¨æŠ½è±¡** | `StorageBackend` æŠ½è±¡å±‚æ”¯æŒæœ¬åœ° SQLite å’Œè¿œç¨‹ S3ï¼Œæ— ç¼åˆ‡æ¢ |
| **æ™ºèƒ½æ¨é€ç­–ç•¥** | ä¸‰ç§æ¨¡å¼ï¼ˆdaily/current/incrementalï¼‰+ æ—¶é—´çª—å£æ§åˆ¶ |
| **æƒé‡æ’åºç®—æ³•** | åŸºäºæ’åã€é¢‘ç‡ã€çƒ­åº¦çš„ç»¼åˆæƒé‡è®¡ç®— |
| **MCP AI åˆ†æ** | åŸºäº Model Context Protocol çš„ AI åˆ†æèƒ½åŠ›ï¼Œæ”¯æŒå¤šå®¢æˆ·ç«¯ |
| **å¤šè´¦å·æ¨é€** | æ‰€æœ‰æ¸ é“æ”¯æŒå¤šè´¦å·é…ç½®ï¼Œç”¨ `;` åˆ†éš” |

---

### 3. ç³»ç»Ÿæ¶æ„å›¾

#### 3.1 é«˜å±‚æ¶æ„

```mermaid
graph TB
    subgraph External["å¤–éƒ¨ç³»ç»Ÿ"]
        API["NewsNow API"]
        RSS["RSS/Atom æº"]
        S3["S3 å…¼å®¹å­˜å‚¨"]
    end

    subgraph TrendRadar["TrendRadar æ ¸å¿ƒ"]
        subgraph Crawler["æ•°æ®é‡‡é›†å±‚"]
            DF["DataFetcher"]
            RF["RSSFetcher"]
        end

        subgraph Core["æ ¸å¿ƒå¤„ç†å±‚"]
            NA["NewsAnalyzer"]
            AN["Analyzer"]
            FQ["Frequency"]
        end

        subgraph Storage["å­˜å‚¨å±‚"]
            SM["StorageManager"]
            LS["LocalStorage"]
            RS["RemoteStorage"]
        end

        subgraph Notification["é€šçŸ¥å±‚"]
            ND["NotificationDispatcher"]
            SP["Splitter"]
            SD["Senders"]
        end

        subgraph Report["æŠ¥å‘Šå±‚"]
            RG["ReportGenerator"]
            HG["HTMLGenerator"]
        end
    end

    subgraph MCP["MCP AI æœåŠ¡"]
        MS["MCP Server"]
        DQ["DataQuery"]
        AT["Analytics"]
        SS["SearchTools"]
    end

    subgraph Channels["æ¨é€æ¸ é“"]
        FS["é£ä¹¦"]
        DT["é’‰é’‰"]
        WW["ä¼ä¸šå¾®ä¿¡"]
        TG["Telegram"]
        SL["Slack"]
        EM["Email"]
    end

    API --> DF
    RSS --> RF
    DF --> NA
    RF --> NA
    NA --> AN
    NA --> FQ
    NA --> SM
    SM --> LS
    SM --> RS
    RS <--> S3
    NA --> ND
    ND --> SP
    SP --> SD
    SD --> Channels
    NA --> RG
    RG --> HG
    SM --> MS
    MS --> DQ
    MS --> AT
    MS --> SS
```

#### 3.2 æ¨¡å—ç»“æ„

```mermaid
graph LR
    subgraph trendradar["trendradar åŒ…"]
        main["__main__.py<br/>ä¸»å…¥å£"]
        context["context.py<br/>åº”ç”¨ä¸Šä¸‹æ–‡"]
        
        subgraph core["core/"]
            analyzer["analyzer.py"]
            config["config.py"]
            data["data.py"]
            frequency["frequency.py"]
            loader["loader.py"]
        end
        
        subgraph crawler["crawler/"]
            fetcher["fetcher.py"]
            rss_pkg["rss/"]
        end
        
        subgraph storage["storage/"]
            base["base.py"]
            manager["manager.py"]
            local["local.py"]
            remote["remote.py"]
        end
        
        subgraph notification["notification/"]
            dispatcher["dispatcher.py"]
            senders["senders.py"]
            splitter["splitter.py"]
            renderer["renderer.py"]
        end
        
        subgraph report["report/"]
            generator["generator.py"]
            html["html.py"]
            formatter["formatter.py"]
        end
    end
    
    subgraph mcp_server["mcp_server åŒ…"]
        server["server.py"]
        
        subgraph tools["tools/"]
            analytics["analytics.py"]
            data_query["data_query.py"]
            search_tools["search_tools.py"]
        end
        
        subgraph services["services/"]
            data_service["data_service.py"]
            cache_service["cache_service.py"]
            parser_service["parser_service.py"]
        end
    end

    main --> context
    main --> core
    main --> crawler
    main --> storage
    main --> notification
    main --> report
    server --> tools
    server --> services
```

---

### 4. ç»„ä»¶æ¶æ„

#### 4.1 æ ¸å¿ƒç»„ä»¶èŒè´£

```mermaid
graph TB
    subgraph Components["æ ¸å¿ƒç»„ä»¶"]
        NA["NewsAnalyzer<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ ä¸»ç¼–æ’å™¨<br/>â€¢ æ¨¡å¼ç­–ç•¥ç®¡ç†<br/>â€¢ æµç¨‹æ§åˆ¶"]
        
        DF["DataFetcher<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ API æ•°æ®æŠ“å–<br/>â€¢ è‡ªåŠ¨é‡è¯•<br/>â€¢ ä»£ç†æ”¯æŒ"]
        
        SM["StorageManager<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ åç«¯é€‰æ‹©<br/>â€¢ ç¯å¢ƒæ£€æµ‹<br/>â€¢ ç»Ÿä¸€æ¥å£"]
        
        AN["Analyzer<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ è¯é¢‘ç»Ÿè®¡<br/>â€¢ æƒé‡è®¡ç®—<br/>â€¢ æ–°å¢æ£€æµ‹"]
        
        ND["NotificationDispatcher<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ å¤šæ¸ é“åˆ†å‘<br/>â€¢ å¤šè´¦å·æ”¯æŒ<br/>â€¢ æ ¼å¼è½¬æ¢"]
        
        RG["ReportGenerator<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ HTML ç”Ÿæˆ<br/>â€¢ å†…å®¹æ ¼å¼åŒ–<br/>â€¢ å›¾ç‰‡å¯¼å‡º"]
    end

    NA --> DF
    NA --> SM
    NA --> AN
    NA --> ND
    NA --> RG
```

#### 4.2 ç»„ä»¶äº¤äº’

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·/å®šæ—¶ä»»åŠ¡
    participant NA as NewsAnalyzer
    participant DF as DataFetcher
    participant SM as StorageManager
    participant AN as Analyzer
    participant ND as NotificationDispatcher
    participant RG as ReportGenerator

    User->>NA: å¯åŠ¨åˆ†æ
    NA->>NA: åˆå§‹åŒ–é…ç½®
    NA->>SM: åˆå§‹åŒ–å­˜å‚¨
    NA->>DF: æŠ“å–çƒ­æ¦œæ•°æ®
    DF-->>NA: è¿”å›åŸå§‹æ•°æ®
    NA->>SM: ä¿å­˜æ–°é—»æ•°æ®
    NA->>AN: ç»Ÿè®¡åˆ†æ
    AN-->>NA: è¿”å›ç»Ÿè®¡ç»“æœ
    NA->>RG: ç”ŸæˆHTMLæŠ¥å‘Š
    RG-->>NA: è¿”å›HTMLè·¯å¾„
    NA->>ND: æ¨é€é€šçŸ¥
    ND-->>NA: æ¨é€ç»“æœ
    NA-->>User: å®Œæˆ
```

---

### 5. ç±»å›¾

#### 5.1 æ•°æ®æ¨¡å‹

```mermaid
classDiagram
    class NewsItem {
        +str title
        +str source_id
        +str source_name
        +int rank
        +str url
        +str mobile_url
        +str crawl_time
        +List~int~ ranks
        +str first_time
        +str last_time
        +int count
        +to_dict() Dict
        +from_dict(data) NewsItem
    }

    class NewsData {
        +str date
        +str crawl_time
        +Dict~str,List~NewsItem~~ items
        +Dict~str,str~ id_to_name
        +List~str~ failed_ids
        +to_dict() Dict
        +from_dict(data) NewsData
        +get_total_count() int
        +merge_with(other)
    }

    class RSSItem {
        +str title
        +str feed_id
        +str feed_name
        +str url
        +str published_at
        +str summary
        +str author
        +str crawl_time
        +to_dict() Dict
        +from_dict(data) RSSItem
    }

    class RSSData {
        +str date
        +str crawl_time
        +Dict~str,List~RSSItem~~ items
        +Dict~str,str~ id_to_name
        +List~str~ failed_ids
        +to_dict() Dict
        +from_dict(data) RSSData
        +get_total_count() int
    }

    NewsData "1" *-- "*" NewsItem : contains
    RSSData "1" *-- "*" RSSItem : contains
```

#### 5.2 å­˜å‚¨æ¶æ„

```mermaid
classDiagram
    class StorageBackend {
        <<abstract>>
        +save_news_data(data) bool
        +get_today_all_data(date) NewsData
        +get_latest_crawl_data(date) NewsData
        +detect_new_titles(data) Dict
        +save_txt_snapshot(data) str
        +save_html_report(html, filename) str
        +is_first_crawl_today(date) bool
        +has_pushed_today(date) bool
        +record_push(report_type, date) bool
        +save_rss_data(data) bool
        +get_rss_data(date) RSSData
        +cleanup_old_data() int
    }

    class LocalStorageBackend {
        -str data_dir
        -str timezone
        -int retention_days
        -Connection db_conn
        +_get_db_path(date) str
        +_init_db(date)
        +_execute_query(sql, params)
    }

    class RemoteStorageBackend {
        -str bucket_name
        -str endpoint_url
        -str access_key
        -str secret_key
        -S3Client s3_client
        +_upload_file(local_path, remote_key)
        +_download_file(remote_key, local_path)
        +sync_to_local(days)
    }

    class StorageManager {
        -str backend_type
        -StorageBackend backend
        -bool pull_enabled
        -int pull_days
        +get_backend() StorageBackend
        +pull_from_remote() int
        +save_news_data(data)
        +get_today_all_data(date)
        +cleanup_old_data()
        +is_github_actions() bool
        +is_docker() bool
    }

    StorageBackend <|-- LocalStorageBackend
    StorageBackend <|-- RemoteStorageBackend
    StorageManager o-- StorageBackend : manages
```

#### 5.3 é€šçŸ¥ç³»ç»Ÿ

```mermaid
classDiagram
    class NotificationDispatcher {
        -Dict config
        -Callable get_time_func
        -Callable split_content_func
        +dispatch_all(report_data, report_type, ...)
        -_send_to_multi_accounts(channel, config, func)
        -_send_feishu(report_data, ...)
        -_send_dingtalk(report_data, ...)
        -_send_wework(report_data, ...)
        -_send_telegram(report_data, ...)
        -_send_ntfy(report_data, ...)
        -_send_bark(report_data, ...)
        -_send_slack(report_data, ...)
        -_send_email(report_type, html_path)
    }

    class ContentSplitter {
        +split_content(content, max_size) List
        +estimate_size(content) int
        +split_for_feishu(content)
        +split_for_telegram(content)
        +split_for_dingtalk(content)
    }

    class Senders {
        <<module>>
        +send_to_feishu(webhook, content)
        +send_to_dingtalk(webhook, content)
        +send_to_wework(webhook, content)
        +send_to_telegram(token, chat_id, content)
        +send_to_ntfy(topic, content)
        +send_to_bark(url, content)
        +send_to_slack(webhook, content)
        +send_to_email(config, html_path)
    }

    class Renderer {
        <<module>>
        +render_feishu_content(stats, new_titles)
        +render_dingtalk_content(stats, new_titles)
        +render_markdown_content(stats, new_titles)
        +render_rss_feishu_content(rss_items)
        +render_rss_markdown_content(rss_items)
    }

    NotificationDispatcher --> ContentSplitter : uses
    NotificationDispatcher --> Senders : uses
    NotificationDispatcher --> Renderer : uses
```

---

### 6. æ—¶åºå›¾

#### 6.1 å¢é‡æ¨¡å¼å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    autonumber
    participant Timer as å®šæ—¶å™¨
    participant NA as NewsAnalyzer
    participant DF as DataFetcher
    participant SM as StorageManager
    participant DB as SQLite
    participant AN as Analyzer
    participant ND as Dispatcher

    Timer->>NA: è§¦å‘æ‰§è¡Œ
    
    rect rgb(240, 248, 255)
        Note over NA,SM: åˆå§‹åŒ–é˜¶æ®µ
        NA->>NA: åŠ è½½é…ç½®
        NA->>SM: åˆå§‹åŒ–å­˜å‚¨ç®¡ç†å™¨
        SM->>SM: æ£€æµ‹è¿è¡Œç¯å¢ƒ
        SM->>DB: è¿æ¥æ•°æ®åº“
    end

    rect rgb(255, 248, 240)
        Note over NA,DF: æ•°æ®é‡‡é›†é˜¶æ®µ
        NA->>DF: æŠ“å–çƒ­æ¦œæ•°æ®
        loop æ¯ä¸ªå¹³å°
            DF->>DF: fetch_data(platform_id)
            DF->>DF: å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
        end
        DF-->>NA: è¿”å› (results, id_to_name, failed_ids)
    end

    rect rgb(240, 255, 240)
        Note over NA,DB: æ•°æ®å­˜å‚¨é˜¶æ®µ
        NA->>NA: è½¬æ¢ä¸º NewsData
        NA->>SM: save_news_data(data)
        SM->>DB: INSERT/MERGE æ–°é—»è®°å½•
    end

    rect rgb(255, 240, 255)
        Note over NA,AN: åˆ†æé˜¶æ®µ
        NA->>SM: detect_new_titles(current_data)
        SM->>DB: æŸ¥è¯¢å†å²æ ‡é¢˜
        SM-->>NA: è¿”å›æ–°å¢æ ‡é¢˜
        NA->>AN: count_word_frequency(results, ...)
        AN-->>NA: è¿”å›ç»Ÿè®¡ç»“æœ
    end

    rect rgb(255, 255, 240)
        Note over NA,ND: é€šçŸ¥é˜¶æ®µ
        alt æœ‰æ–°å¢å†…å®¹
            NA->>ND: dispatch_all(report_data, ...)
            ND->>ND: æ¸²æŸ“å„æ¸ é“å†…å®¹
            ND->>ND: åˆ†æ‰¹æ¨é€
            ND-->>NA: æ¨é€ç»“æœ
        else æ— æ–°å¢
            NA->>NA: è·³è¿‡æ¨é€
        end
    end
```

#### 6.2 MCP æŸ¥è¯¢æµç¨‹

```mermaid
sequenceDiagram
    autonumber
    participant Client as AI å®¢æˆ·ç«¯
    participant MCP as MCP Server
    participant DS as DataService
    participant SM as StorageManager
    participant DB as SQLite

    Client->>MCP: è°ƒç”¨å·¥å…· (å¦‚ search_news)
    MCP->>MCP: è§£æå‚æ•°
    MCP->>DS: query_news(keyword, date_range)
    DS->>SM: get_today_all_data(date)
    SM->>DB: SELECT * FROM news WHERE date = ?
    DB-->>SM: è¿”å›è®°å½•
    SM-->>DS: NewsData
    DS->>DS: è¿‡æ»¤å’Œæ’åº
    DS-->>MCP: æŸ¥è¯¢ç»“æœ
    MCP->>MCP: æ ¼å¼åŒ–è¾“å‡º
    MCP-->>Client: JSON å“åº”
```

---

### 7. æ•°æ®æµå›¾

#### 7.1 æ•°æ®å¤„ç†æµç¨‹

```mermaid
flowchart LR
    subgraph Input["æ•°æ®è¾“å…¥"]
        API["NewsNow API"]
        RSS["RSS æº"]
    end

    subgraph Collect["æ•°æ®é‡‡é›†"]
        DF["DataFetcher"]
        RF["RSSFetcher"]
    end

    subgraph Process["æ•°æ®å¤„ç†"]
        Parse["è§£æå“åº”"]
        Convert["è½¬æ¢æ•°æ®æ¨¡å‹"]
        Merge["åˆå¹¶å†å²æ•°æ®"]
    end

    subgraph Analyze["åˆ†æå¤„ç†"]
        Match["å…³é”®è¯åŒ¹é…"]
        Weight["æƒé‡è®¡ç®—"]
        Detect["æ–°å¢æ£€æµ‹"]
        Stats["ç»Ÿè®¡æ±‡æ€»"]
    end

    subgraph Store["æ•°æ®å­˜å‚¨"]
        Local["æœ¬åœ° SQLite"]
        Remote["è¿œç¨‹ S3"]
    end

    subgraph Output["è¾“å‡º"]
        HTML["HTML æŠ¥å‘Š"]
        Push["æ¨é€é€šçŸ¥"]
        MCP["MCP æŸ¥è¯¢"]
    end

    API --> DF --> Parse
    RSS --> RF --> Parse
    Parse --> Convert --> Merge
    Merge --> Local
    Merge --> Remote
    Local --> Match
    Match --> Weight --> Detect --> Stats
    Stats --> HTML
    Stats --> Push
    Local --> MCP
```

#### 7.2 æƒé‡è®¡ç®—å…¬å¼

```mermaid
graph LR
    subgraph Inputs["è¾“å…¥å› å­"]
        R["æ’å (rank)"]
        F["å‡ºç°é¢‘æ¬¡ (count)"]
        H["çƒ­åº¦å€¼ (hotness)"]
    end

    subgraph Weights["æƒé‡é…ç½®"]
        RW["RANK_WEIGHT = 1.0"]
        FW["FREQUENCY_WEIGHT = 0.5"]
        HW["HOTNESS_WEIGHT = 0.3"]
    end

    subgraph Formula["è®¡ç®—å…¬å¼"]
        W["weight = <br/>(threshold - avg_rank) Ã— RW +<br/>count Ã— FW +<br/>hotness Ã— HW"]
    end

    subgraph Output["è¾“å‡º"]
        S["æ’åºåçš„æ–°é—»åˆ—è¡¨"]
    end

    R --> W
    F --> W
    H --> W
    RW --> W
    FW --> W
    HW --> W
    W --> S
```

---

### 8. éƒ¨ç½²æ¶æ„

#### 8.1 éƒ¨ç½²æ¨¡å¼

```mermaid
graph TB
    subgraph GitHub["GitHub Actions éƒ¨ç½²"]
        GA["GitHub Actions"]
        GS["GitHub Secrets"]
        GP["GitHub Pages"]
        GA --> GS
        GA --> GP
    end

    subgraph Docker["Docker éƒ¨ç½²"]
        DC["docker-compose"]
        DV["Volume æŒ‚è½½"]
        DE["ç¯å¢ƒå˜é‡"]
        DC --> DV
        DC --> DE
    end

    subgraph Local["æœ¬åœ°éƒ¨ç½²"]
        PY["Python è™šæ‹Ÿç¯å¢ƒ"]
        CF["config.yaml"]
        OP["output ç›®å½•"]
        PY --> CF
        PY --> OP
    end

    subgraph Storage["å­˜å‚¨é€‰æ‹©"]
        LS["æœ¬åœ° SQLite"]
        RS["è¿œç¨‹ S3/R2"]
    end

    GitHub --> RS
    Docker --> LS
    Docker --> RS
    Local --> LS
```

#### 8.2 Docker æ¶æ„

```mermaid
graph TB
    subgraph Host["å®¿ä¸»æœº"]
        subgraph Container1["trendradar å®¹å™¨"]
            App["Python åº”ç”¨"]
            Cron["å®šæ—¶ä»»åŠ¡"]
        end
        
        subgraph Container2["trendradar-mcp å®¹å™¨"]
            MCPApp["MCP Server"]
            Port["ç«¯å£ 3333"]
        end

        subgraph Volumes["æ•°æ®å·"]
            Config["./config:/app/config"]
            Output["./output:/app/output"]
        end

        subgraph Network["ç½‘ç»œ"]
            Ext["å¤–éƒ¨ç½‘ç»œ"]
        end
    end

    App --> Config
    App --> Output
    MCPApp --> Config
    MCPApp --> Output
    MCPApp --> Port
    Port --> Ext
```

---

### 9. MCP æœåŠ¡æ¶æ„

#### 9.1 MCP å·¥å…·åˆ†ç±»

```mermaid
mindmap
  root((MCP Tools))
    æ—¥æœŸè§£æ
      resolve_date_range
        è‡ªç„¶è¯­è¨€è§£æ
        æ ‡å‡†æ—¥æœŸè¾“å‡º
    æ•°æ®æŸ¥è¯¢
      get_latest_news
      get_news_by_date
      get_trending_topics
    RSSæŸ¥è¯¢
      get_latest_rss
      search_rss
      get_rss_feeds_status
    æ™ºèƒ½æœç´¢
      search_news
      find_related_news
      aggregate_news
    é«˜çº§åˆ†æ
      analyze_topic_trend
      analyze_data_insights
      compare_periods
    ç³»ç»Ÿç®¡ç†
      sync_from_remote
      get_storage_status
      list_available_dates
```

#### 9.2 MCP æœåŠ¡æ¶æ„

```mermaid
graph TB
    subgraph Clients["AI å®¢æˆ·ç«¯"]
        CD["Claude Desktop"]
        CS["Cherry Studio"]
        CU["Cursor"]
        CL["Cline"]
    end

    subgraph Transport["ä¼ è¾“å±‚"]
        STDIO["stdio æ¨¡å¼"]
        HTTP["HTTP æ¨¡å¼ (:3333)"]
    end

    subgraph Server["MCP Server"]
        FM["FastMCP 2.0"]
        
        subgraph Tools["å·¥å…·å±‚"]
            DQ["æ•°æ®æŸ¥è¯¢å·¥å…·"]
            AT["åˆ†æå·¥å…·"]
            ST["æœç´¢å·¥å…·"]
            SY["ç³»ç»Ÿå·¥å…·"]
        end

        subgraph Services["æœåŠ¡å±‚"]
            DataSvc["DataService"]
            CacheSvc["CacheService"]
            ParserSvc["ParserService"]
        end
    end

    subgraph Data["æ•°æ®å±‚"]
        SM["StorageManager"]
        DB["SQLite"]
    end

    Clients --> STDIO
    Clients --> HTTP
    STDIO --> FM
    HTTP --> FM
    FM --> Tools
    Tools --> Services
    Services --> SM
    SM --> DB
```

#### 9.3 å·¥å…·è°ƒç”¨ç¤ºä¾‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant AI as AI æ¨¡å‹
    participant MCP as MCP Server
    participant Tool as å·¥å…·å‡½æ•°
    participant Data as æ•°æ®æœåŠ¡

    User->>AI: "åˆ†ææœ¬å‘¨ AI ç›¸å…³æ–°é—»è¶‹åŠ¿"
    AI->>MCP: resolve_date_range("æœ¬å‘¨")
    MCP-->>AI: {start: "2026-12-26", end: "2026-01-01"}
    AI->>MCP: analyze_topic_trend("AI", date_range, "trend_tracking")
    MCP->>Tool: è°ƒç”¨åˆ†æå·¥å…·
    Tool->>Data: æŸ¥è¯¢å†å²æ•°æ®
    Data-->>Tool: è¿”å›æ—¶åºæ•°æ®
    Tool->>Tool: è®¡ç®—è¶‹åŠ¿
    Tool-->>MCP: è¶‹åŠ¿åˆ†æç»“æœ
    MCP-->>AI: JSON å“åº”
    AI-->>User: "æœ¬å‘¨ AI ç›¸å…³æ–°é—»å‘ˆä¸Šå‡è¶‹åŠ¿..."
```

---

### é™„å½•

#### A. é…ç½®æ–‡ä»¶ç»“æ„

```yaml
# config/config.yaml ç»“æ„æ¦‚è§ˆ
app:
  enable_crawler: true
  report_mode: "daily"  # daily/current/incremental
  timezone: "Asia/Shanghai"

report:
  max_news_per_keyword: 10
  display_mode: "keyword"  # keyword/platform

notification:
  feishu_webhook_url: ""
  telegram_bot_token: ""
  # ... å…¶ä»–æ¸ é“é…ç½®

storage:
  backend_type: "auto"  # local/remote/auto
  local_retention_days: 30
  remote_config:
    endpoint_url: ""
    bucket_name: ""

platforms:
  - zhihu
  - weibo
  - douyin
  # ... æ›´å¤šå¹³å°

rss:
  enabled: false
  feeds: []
```

#### B. æ•°æ®åº“ Schema

```sql
-- çƒ­æ¦œæ–°é—»è¡¨
CREATE TABLE IF NOT EXISTS news (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    source_id TEXT NOT NULL,
    title TEXT NOT NULL,
    url TEXT,
    mobile_url TEXT,
    ranks TEXT,  -- JSON æ•°ç»„
    first_time TEXT,
    last_time TEXT,
    count INTEGER DEFAULT 1,
    crawl_time TEXT,
    UNIQUE(source_id, title)
);

-- RSS æ¡ç›®è¡¨
CREATE TABLE IF NOT EXISTS rss_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    feed_id TEXT NOT NULL,
    title TEXT NOT NULL,
    url TEXT,
    published_at TEXT,
    summary TEXT,
    author TEXT,
    first_time TEXT,
    last_time TEXT,
    count INTEGER DEFAULT 1,
    crawl_time TEXT,
    UNIQUE(feed_id, title)
);

-- æ¨é€è®°å½•è¡¨
CREATE TABLE IF NOT EXISTS push_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    report_type TEXT NOT NULL,
    push_time TEXT NOT NULL
);
```

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0.0 | æ›´æ–°æ—¥æœŸ: 2026-01-01*

